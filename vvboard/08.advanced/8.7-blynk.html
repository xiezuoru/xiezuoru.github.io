

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>7. Blynk本地服务器的部署 &mdash; 虚谷号使用手册 1.0 文档</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="8. 唤醒词检测引擎Snowboy" href="8.8-Snowboy.html" />
    <link rel="prev" title="6. 搭建LNMP和WordPress" href="8.6-lnmp.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> 虚谷号使用手册
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../01.about/index.html">关于虚谷号</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02.quick/index.html">虚谷号的入门教程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03.basic/index.html">虚谷号的基本操作</a></li>
<li class="toctree-l1"><a class="reference internal" href="../04.gpio/index.html">虚谷号的GPIO详解</a></li>
<li class="toctree-l1"><a class="reference internal" href="../05.soft/index.html">虚谷号的软件介绍</a></li>
<li class="toctree-l1"><a class="reference internal" href="../06.edu/index.html">虚谷号的教育应用</a></li>
<li class="toctree-l1"><a class="reference internal" href="../07.plus/index.html">虚谷号的扩展硬件</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">虚谷号的高级操作</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="8.1-troubleshooting.html">1. 常见故障解答</a></li>
<li class="toctree-l2"><a class="reference internal" href="8.2-dap-index.html">2. U盘目录详解</a></li>
<li class="toctree-l2"><a class="reference internal" href="8.3-hardware-resources.html">3. 虚谷号硬件资源详解</a></li>
<li class="toctree-l2"><a class="reference internal" href="8.4-soft-setup.html">4. 虚谷号的软件安装</a></li>
<li class="toctree-l2"><a class="reference internal" href="8.5-docker.html">5. 虚谷号和Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="8.6-lnmp.html">6. 搭建LNMP和WordPress</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">7. Blynk本地服务器的部署</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">7.1. Blynk简介</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">7.2. 在手机上部署Blynk客户端</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">7.3. 在虚谷号上部署Blynk服务器</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">7.4. Blynk案例</a></li>
<li class="toctree-l3"><a class="reference internal" href="#winformblynk">7.5. winform连入blynk服务</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">7.6. Blynk能量值的修改</a></li>
<li class="toctree-l3"><a class="reference internal" href="#siotblynk">7.7. 对比SIoT和Blynk</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">7.8. 涉及知识点</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7">7.9. 参考资料</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="8.8-Snowboy.html">8. 唤醒词检测引擎Snowboy</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../09.case/index.html">虚谷号的案例汇集</a></li>
<li class="toctree-l1"><a class="reference internal" href="../10.course/index.html">虚谷号的课程汇集</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">虚谷号使用手册</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">虚谷号的高级操作</a> &raquo;</li>
        
      <li>7. Blynk本地服务器的部署</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/08.advanced/8.7-blynk.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="blynk">
<h1>7. Blynk本地服务器的部署<a class="headerlink" href="#blynk" title="永久链接至标题">¶</a></h1>
<p>Blynk是一个物联网平台，旨在简化物联网的移动和Web应用程序的构建。虚谷号上已经整合了SIoT，但是Blynk也可以同时部署。</p>
<div class="section" id="id1">
<h2>7.1. Blynk简介<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<p>Blynk的App是具有易于使用的拖放系统，可为IoT设置构建自定义控件。工作流程非常快速：启动新项目时，系统会提示您从广泛的列表中选择开发板，以及连接方式。然后，该应用通过电子邮件发送授权令牌，以通过Blynk服务器连接到您的设备。应用中的提供了很多小部件。每个小部件都有一个编辑菜单，可让您更改名称和颜色。然后，您选择要影响的引脚（无论是板上的引脚还是Blynk的虚拟引脚之一）以及要发送的值范围。对于图形或文本框之类的输出显示，您还可以选择更新频率，从而节省宝贵的带宽。Blynk还具有将指令分配给“虚拟”引脚的功能，这是用户配置的应用程序与硬件之间的连接。因此，应用程序中的单个按钮可用于触发设备上的许多不同事件。</p>
<p>相对于其他MQTT的服务器来说，Blynk的优势在于连接快速，且提供了免费的移动平台上的配套应用，包括iOS和Android。</p>
<p>Blynk项目分为三个部分：</p>
<p><strong>1.Blynk应用（App）</strong></p>
<p>Blynk的App是具有易于使用的拖放系统，可为IoT设置构建自定义控件。工作流程非常快速：启动新项目时，系统会提示您从广泛的列表中选择开发板，以及连接方式。然后，该应用通过电子邮件发送授权令牌，以通过Blynk服务器连接到您的设备。</p>
<img alt="../_images/8.7-ad.png" src="../_images/8.7-ad.png" />
<p>应用中的提供了很多小部件。每个小部件都有一个编辑菜单，可让您更改名称和颜色。然后，您选择要影响的引脚（无论是板上的引脚还是Blynk的虚拟引脚之一）以及要发送的值范围。对于图形或文本框之类的输出显示，您还可以选择更新频率，从而节省宝贵的带宽。</p>
<p>Blynk还具有将指令分配给“虚拟”引脚的功能，这是用户配置的应用程序与硬件之间的连接。因此，应用程序中的单个按钮可用于触发设备上的许多不同事件。</p>
<p><strong>2.Blynk服务器</strong></p>
<p>创建了用于控制设备的应用后，您可以有两种方法与之通信。</p>
<p>第一选择是用Blynk云服务器。这个服务器快速，响应迅速且免费使用。连接到Wi-Fi设备就像将生成的授权代码复制到Arduino草图中并提供Wi-Fi详细信息一样容易。</p>
<p>第二个选择是自己部署Blynk服务器。 Blynk提供了一个基于Netty的开源Java服务器，可以从您的计算机甚至Raspberry Pi、虚谷号(vvboard)、拿铁熊猫(LattePanda)之类的迷你电脑来运行该服务器。在功能和安全性方面，这为某些用户带来了各种好处。</p>
<p>这里我们当然选择第二种方式。</p>
<p><strong>3.Blynk库</strong></p>
<p>Blynk提供了完善的Blynk库。该库与大量开发板一起使用，以允许该应用程序与您的硬件之间进行通信。</p>
<ul class="simple">
<li><p>Blynk官方网址：<a class="reference external" href="https://blynk.io/">https://blynk.io/</a></p></li>
</ul>
</div>
<div class="section" id="id2">
<h2>7.2. 在手机上部署Blynk客户端<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<p>iOS系统用户可在应用商店下载，Android用户可以在网络上搜索安装包或通过下面链接下载安装包。</p>
<ul class="simple">
<li><p>Android下载地址：<a class="reference external" href="https://m.baidu.com/ala/c/m.eoemarket.com/apps/show/id/830895">https://m.baidu.com/ala/c/m.eoemarket.com/apps/show/id/830895</a></p></li>
</ul>
<p>安装完成后无需注册。（针对自己部署Blynk服务器）</p>
</div>
<div class="section" id="id3">
<h2>7.3. 在虚谷号上部署Blynk服务器<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h2>
<p>虚谷号部署Blynk本地服务器，其实也比较简单，可以通过jupyter的终端、ssh或者远程桌面来执行下面的命令。</p>
<ol class="arabic simple">
<li><p>查看虚谷号java版本。打开桌面LX终端，输入java -version，显示8.0版本。</p></li>
<li><p>下载Blynk服务器jar文件</p></li>
</ol>
<p>1)在lx终端内输入 wget “<a class="reference external" href="https://github.com/blynkkk/blynk-server/releases/download/v0.41.12/server-0.41.12-java8.jar">https://github.com/blynkkk/blynk-server/releases/download/v0.41.12/server-0.41.12-java8.jar</a>”，但是速度慢，传输容易断不续传，不建议。</p>
<p>2）直接浏览器下载https://github.com/blynkkk/blynk-server/releases/download/v0.41.12/server-0.41.12-java8.jar</p>
<p><strong>注：</strong> 教育网下载速度较快，下载失败可以尝试更换网络连接，如用手机热点等。</p>
<p>3）为了方便，将下载的文件移动到/home/scope/下。</p>
<p><strong>注：</strong> 可以在自己的电脑下载，然后通过jupyter上传，或者用U盘拷贝。</p>
<ol class="arabic simple" start="3">
<li><p>虚谷内置的SIoT使用8080端口和Blynk服务端口冲突，你可以选择关闭SIoT或者修改SIoT端口。</p></li>
</ol>
<p><strong>方法一：关闭SIoT</strong></p>
<p>用U盘模式打开，修改/vvBoard/vvBoard_config.ini中Siot=0，重启虚谷号。</p>
<p><strong>方法二：修改SIoT端口（推荐）</strong></p>
<p>远程桌面连接，打开/home/scope/software/SIoT_1_2_vvBoard/config.json修改”WebServerAdrr”:”0.0.0.0:8088”。这样SIoT的服务端口可以改为8088。重启虚谷号生效。</p>
<p>这种方法也有缺点，以后访问SIoT需要在浏览器出入IP:8088，以前通过快捷方式访问的方法失效了，而且在调用API时也要留心。</p>
<img alt="../_images/8.7-3-siot.png" src="../_images/8.7-3-siot.png" />
<p>4. 打开LX终端,输入以下命令，如果路径不同或者文件名不同请做相应修改。在默认的“硬件端口8080”和默认的“应用程序端口9443”（SSL端口）上运行服务器
java -jar /home/scope/server-0.41.12-java8.jar -dataFolder /home/scope/Blynk
看到Blynk Server successfully started,那就恭喜你成功了，看到Blynk Server successfully started,那就恭喜你成功了，第一次运行还会提示默认用户名和密码。</p>
<p>用户名为admin&#64;blynk.cc</p>
<p>密码为admin</p>
<img alt="../_images/8.7-4.png" src="../_images/8.7-4.png" />
<p>如果想要每次虚谷号开机就自启动的话，可以修改/etc/rc.local文件，在exit 0上面一行输入</p>
<p>java -jar/home/scope/server-0.41.12-java8.jar -dataFolder /home/scope/Blynk start &amp;</p>
<p>其实关键就在于在命令行后面加了start &amp; ，意思是保持后台运行。如果今后有其他命令需要开机自启动，也可以添加到这里，这个文件是开机时执行的脚本文件。</p>
<img alt="../_images/8.7-rc.jpg" src="../_images/8.7-rc.jpg" />
<p>具体操作如下：远程桌面连接下打开文件，默认是用vim打开的，按i进入编辑模式，用方向键移动到exit 0 的上一行，输入上面的文字，按ESC退出编辑模式，输入“:wq”保存退出。如果遇到问题，可以上网搜索vim，可以找到很多帮助文档。</p>
<p>重启生效。</p>
<ol class="arabic simple" start="5">
<li><p>通过U盘模式查看虚谷号的IP地址，具体操作为打开/vvBoard/wifi_log.txt，查看inet地址。</p></li>
</ol>
<p>手机上打开Blynk，点击Log In，点击下方链路图标，滑动开关至CUSTOM。输入刚刚查到的ip地址，后面的9443是端口号，无需修改。点击OK。</p>
<ol class="arabic simple" start="6">
<li><p>，输入账户名(<a class="reference external" href="mailto:admin&#37;&#52;&#48;blynk&#46;cc">admin<span>&#64;</span>blynk<span>&#46;</span>cc</a>)和密码(admin)，点击Log In。</p></li>
</ol>
<img alt="../_images/8.7-login.png" src="../_images/8.7-login.png" />
</div>
<div class="section" id="id4">
<h2>7.4. Blynk案例<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h2>
<p><strong>案例一：控制LED灯</strong></p>
<p>首先，我们要新建一个项目。具体操作是：在手机App上登录后，点击New Project，输入项目名称后，其余无需修改（任选一项也行），点击Create，就完成了。</p>
<img alt="../_images/8.7-NewProject.png" src="../_images/8.7-NewProject.png" />
<p>点亮小灯是硬件实验入门必备的实验，首先我们在App上点击右上角的“+”，点击Bottom，添加一个按钮。设置中将PIN设置为V1（意思是虚拟管脚，用于通信，可以理解为“串口”）。MODE可以选择PUSH(按住有效)或者SWITCH（按后有效，推荐）。</p>
<img alt="../_images/8.7-Bottom.png" src="../_images/8.7-Bottom.png" />
<p>初次使用，我们需要安装Blynk库文件。使用pip3 install blynk-library-python。</p>
<p>接下来，运行以下python代码。你可以使用自带的Python运行，或者Python IDE运行，也可以使用Jupyter运行。</p>
<p>其中的’YourAuthToken’需要替换为你的设备码（引号不可缺），可以从App点击设置图标，点击Copy all复制。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">xugu</span> <span class="k">import</span> <span class="n">Pin</span>

<span class="c1"># 初始化Blynk</span>
<span class="n">YourAuthToken</span><span class="o">=</span><span class="s1">&#39;R1hVw53mObJaHUn2ym9u4LKEINUqfNSa&#39;</span>                <span class="c1"># 替换为你的Token</span>
<span class="n">YourHost</span><span class="o">=</span><span class="s1">&#39;192.168.1.100&#39;</span>                                        <span class="c1"># 替换为你的虚谷号IP，或服务器IP</span>
<span class="n">blynk</span> <span class="o">=</span> <span class="n">BlynkLib</span><span class="o">.</span><span class="n">Blynk</span><span class="p">(</span><span class="n">YourAuthToken</span><span class="p">,</span><span class="n">server</span><span class="o">=</span><span class="n">YourHost</span><span class="p">,</span><span class="n">port</span><span class="o">=</span><span class="mi">8080</span><span class="p">)</span> <span class="c1"># 实例化Blynk</span>

<span class="c1"># 声明虚拟引脚 Virtual Pins</span>
<span class="nd">@blynk</span><span class="o">.</span><span class="n">VIRTUAL_WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># 声明V1读入</span>
<span class="k">def</span> <span class="nf">my_write_handler</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Current V1 value: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="c1"># 输出读入值</span>
    <span class="k">if</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;1&#39;</span><span class="p">:</span>                           <span class="c1"># 值为1则开灯</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;on&#39;</span><span class="p">)</span>
        <span class="n">led</span><span class="o">.</span><span class="n">write_digital</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>                            <span class="c1"># 值为0则关灯</span>
        <span class="n">led</span><span class="o">.</span><span class="n">write_digital</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="nd">@blynk</span><span class="o">.</span><span class="n">VIRTUAL_READ</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># 声明V2输出，仅示范，这里没有用到</span>
<span class="k">def</span> <span class="nf">my_read_handler</span><span class="p">():</span>
    <span class="c1"># this widget will show some time in seconds..</span>
    <span class="n">blynk</span><span class="o">.</span><span class="n">virtual_write</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()))</span>    <span class="c1"># 输出当前时间</span>

<span class="n">led</span> <span class="o">=</span> <span class="n">Pin</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="n">Pin</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span> <span class="c1"># 从xugu导入的Pin，初始化管脚13为数字输入</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">blynk</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>  <span class="c1"># 始终保持Blynk运行</span>
</pre></div>
</div>
<p>试一试，点击手机右上方运行图标后，是不是可以成功用按钮控制LED灯了呢？</p>
<p>我们通过一张图片来了解一下控制的过程。</p>
<img alt="../_images/8.7-system.png" src="../_images/8.7-system.png" />
<p><strong>案例二：在岗检测仪</strong></p>
<p>手机端和上一个案例一样，不需要改变，如果您没有完成上一个案例，建议先完成上一个案例，循序渐进。如果您已经完成了，可以忽略本段文字，如果没有，可以看看这里的步骤说明。和上一个案例一样，首先，我们要新建一个项目。具体操作是：在手机App上登录后，点击New Project，输入项目名称后点击Create，就完成了。我们在App上点击右上角的“+”，点击Bottom，添加一个按钮。设置中将PIN设置为V1（意思是虚拟管脚，用于通信，可以理解为“串口”）。MODE可以选择PUSH(按住有效)或者SWITCH（按后有效，推荐）。</p>
<p>虚谷号需要连接硬件，一个红外数字避障传感器，如图所示。</p>
<img alt="../_images/8.7-pin.png" src="../_images/8.7-pin.png" />
<p>这里给出红外数字避障传感器接线说明，自上而下是信号线，5v线，GND线。请根据颜色判断。</p>
<img alt="../_images/8.7-sig.png" src="../_images/8.7-sig.png" />
<p>接下来，在虚谷号上编程，初次使用，我们需要安装Blynk库文件。使用pip3 install blynk-library-python。你可以使用自带的Python运行，或者Python IDE运行，也可以使用Jupyter运行。运行以下代码。</p>
<p>注意：运行顺序，先打开手机App，再运行代码，期间手机App不要关闭，因为这里要向App传输数据，而上一个案例则不用，部分手机不支持后台运行，可能会导致程序中断。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">BlynkLib</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">xugu</span> <span class="k">import</span> <span class="n">Pin</span>

<span class="c1"># 初始化 Blynk</span>
<span class="n">YourAuthToken</span><span class="o">=</span><span class="s1">&#39;R1hVw53mObJaHUn2ym9u4LKEINUqfNSa&#39;</span>                <span class="c1"># 替换为你的Token</span>
<span class="n">YourHost</span><span class="o">=</span><span class="s1">&#39;192.168.1.100&#39;</span>                                        <span class="c1"># 替换为你的虚谷号IP，或服务器IP</span>
<span class="n">blynk</span> <span class="o">=</span> <span class="n">BlynkLib</span><span class="o">.</span><span class="n">Blynk</span><span class="p">(</span><span class="n">YourAuthToken</span><span class="p">,</span><span class="n">server</span><span class="o">=</span><span class="n">YourHost</span><span class="p">,</span><span class="n">port</span><span class="o">=</span><span class="mi">8080</span><span class="p">)</span> <span class="c1"># 实例化Blynk</span>

<span class="c1"># 声明虚拟引脚 Pins</span>
<span class="nd">@blynk</span><span class="o">.</span><span class="n">VIRTUAL_WRITE</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># 声明V1读入</span>
<span class="k">def</span> <span class="nf">my_write_handler</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Current V1 value: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="c1"># 输出读入值</span>


<span class="k">def</span> <span class="nf">BottomLabelInit</span><span class="p">(</span><span class="n">PIN</span><span class="p">):</span> <span class="c1"># 修改按钮上的标签名，更符合实际应用场景</span>
    <span class="n">blynk</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="n">PIN</span><span class="p">,</span><span class="s1">&#39;onLabel&#39;</span><span class="p">,</span><span class="s1">&#39;在岗&#39;</span><span class="p">)</span>  <span class="c1"># 修改on为“在岗”</span>
    <span class="n">blynk</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="n">PIN</span><span class="p">,</span><span class="s1">&#39;offLabel&#39;</span><span class="p">,</span><span class="s1">&#39;离开&#39;</span><span class="p">)</span> <span class="c1"># 修改off为“离开”</span>


<span class="n">seat</span> <span class="o">=</span> <span class="n">Pin</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">Pin</span><span class="o">.</span><span class="n">IN</span><span class="p">)</span> <span class="c1"># 从xugu导入的Pin，初始化管脚4为数字输出（红外数字避障传感器信号线）</span>
<span class="n">BottomLabelInit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>    <span class="c1"># 修改V1对应的按钮</span>
<span class="n">flag</span> <span class="o">=</span> <span class="mi">0</span>              <span class="c1"># 状态变量初始化为“离开”</span>

<span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">blynk</span><span class="o">.</span><span class="n">run</span><span class="p">()</span> <span class="c1"># 始终保持Blynk运行</span>
    <span class="k">if</span> <span class="n">flag</span> <span class="o">!=</span> <span class="n">seat</span><span class="o">.</span><span class="n">read_digital</span><span class="p">():</span>   <span class="c1"># 当状态改变时</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="n">seat</span><span class="o">.</span><span class="n">read_digital</span><span class="p">()</span>    <span class="c1"># 修改状态变量的值</span>
        <span class="n">blynk</span><span class="o">.</span><span class="n">virtual_write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="n">flag</span><span class="p">)</span> <span class="c1"># 修改V1的值（即修改按钮V1的状态），思考这里为什么用1-flag呢？</span>
        <span class="k">if</span> <span class="n">flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;离开&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;在岗&#39;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>                     <span class="c1"># 设置检测间隔时间</span>
</pre></div>
</div>
<p>如果你想要添加其他老师在岗信息，要怎么做呢？动手试一试吧！</p>
<img alt="../_images/8.7-ext.png" src="../_images/8.7-ext.png" />
<p><strong>提示：</strong> 手机端修改为如图所示，那么程序应该怎么改呢？如果没有红外数字避障传感器，又应该怎么替代呢？这些问题就留给你们思考啦！</p>
<p>详细案例介绍可以查看github资料，/vvBoard-docs/课程汇集/虚谷号内置课程目录/2.物联网应用/Blynk学习案例：在岗检测仪（.ipynb/.pdf）。</p>
<p>老师们有意见和建议可以发送邮件到easonqys&#64;foxmail.com，也可以在论坛共同交流。</p>
<p><strong>其他案例</strong> 网络上还有很多相关案例，只要是Blynk的案例，用虚谷号做Blynk服务器也都能实现，包括一些用树莓派做案例的，也是类似的。</p>
<p>这里给出看到的一些较好的案例，难度比上面的案例高出不少。</p>
<p>用树莓派搭建的校园气象信息检测系统 <a class="reference external" href="https://www.jianshu.com/p/3b7c1bb0f7b8">https://www.jianshu.com/p/3b7c1bb0f7b8</a> （涉及Metabese）</p>
<p>怎样在智能手机上使用BlynkApp远程控制Arduino <a class="reference external" href="http://www.elecfans.com/d/1003098.html">http://www.elecfans.com/d/1003098.html</a> （USB模式连接，无需Wi-Fi）</p>
<p>【零知ESP8266】 Blynk手机APP教程：监控室内温湿度 <a class="reference external" href="http://www.51hei.com/bbs/forum.php?mod=viewthread&amp;tid=162936">http://www.51hei.com/bbs/forum.php?mod=viewthread&amp;tid=162936</a>  （扫码分享你的创意）</p>
<p>【Blynk扩展库】Mind+中也能愉快地使用Blynk物联网平台了！<a class="reference external" href="https://mc.dfrobot.com.cn/thread-303476-1-1.html#lastpost">https://mc.dfrobot.com.cn/thread-303476-1-1.html#lastpost</a> （Mind+Blynk终端）</p>
</div>
<div class="section" id="winformblynk">
<h2>7.5. winform连入blynk服务<a class="headerlink" href="#winformblynk" title="永久链接至标题">¶</a></h2>
<p>既然在App上可以控制和查看开发板，那么在PC端也应该可以。在blynk的官网可以找到关于blynk server的http的接口，这些接口可以使我们在没有App的情况下对开发板进行控制和读取数据。</p>
<p>1、获取引脚值。向 <a class="reference external" href="http://blynk-cloud.com/auth_token/get/pin">http://blynk-cloud.com/auth_token/get/pin</a> 发送get请求。其中 blynk-clound.com 可以替换为自己的服务器，请求的端口与硬件使用的端口一致，默认为8080端口。auth_token为自己project的token码。get意为获取。pin为要读取的引脚值。</p>
<p>2、设置引脚值。向 <a class="reference external" href="http://blynk-cloud.com/auth_token/update/pin?value=vlaue">http://blynk-cloud.com/auth_token/update/pin?value=vlaue</a> 发送get请求。其中pin为引脚，value为修改的值。</p>
<p>3、开发板是否在线。向 <a class="reference external" href="http://blynk-cloud.com/auth_token/isHardwareConnected">http://blynk-cloud.com/auth_token/isHardwareConnected</a> 发送get请求，返回值true为在线，false为离线。</p>
<p>更多接口和实验例子请到 <a class="reference external" href="https://blynkapi.docs.apiary.io/#reference">https://blynkapi.docs.apiary.io/#reference</a> 查看。</p>
<p>感谢CSDN博主「love范德萨」的帮助，原文链接见参考资料。</p>
</div>
<div class="section" id="id5">
<h2>7.6. Blynk能量值的修改<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h2>
<p>由于默认能量值是10000，而实际上对于本地服务器来说，可以无限续命。操作如下：</p>
<p>通过远程桌面连接进入/home/scope/Blynk可以看到一个名为admin&#64;blynk.cc.Blynk.user的文件，打开它。其内容就是显示在手机App里的那些内容，在最后一行，可以看到”energy:”，修改后面的数字，重启虚谷号，就可以实现能量值的修改了。</p>
</div>
<div class="section" id="siotblynk">
<h2>7.7. 对比SIoT和Blynk<a class="headerlink" href="#siotblynk" title="永久链接至标题">¶</a></h2>
<p>SIoT网页版可以在多种终端查看，且具有API供其他程序调用，但是功能较为单一，市面上应用较少。</p>
<p>Blynk只能通过手机端控制，但是功能丰富，界面实用性强，现有应用较丰富。</p>
</div>
<div class="section" id="id6">
<h2>7.8. 涉及知识点<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h2>
<p><strong>*未完待续*</strong></p>
<blockquote>
<div><p>1、物联网；</p>
<p>2、服务器；</p>
<p>3、串口通信；</p>
<p>4、红外测距；</p>
<p>5、树莓派与虚谷号的对比；</p>
<p>6.docker <a class="reference external" href="https://www.zkii.net/system/infrastructure/1189.html">https://www.zkii.net/system/infrastructure/1189.html</a></p>
<p>……</p>
</div></blockquote>
</div>
<div class="section" id="id7">
<h2>7.9. 参考资料<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h2>
<p>参考网址：</p>
<p>1、在虚谷号上安装Blynk服务器https://mc.dfrobot.com.cn/thread-302809-1-1.html</p>
<p>2、后台运行Blynk的方法https://mc.dfrobot.com.cn/thread-303548-1-1.html</p>
<p>3、官方库文件文档https://github.com/vshymanskyy/blynk-library-python</p>
<p>4、Arduino与Blynk案例https://www.jianshu.com/p/df1f33ad5274</p>
<p>5、基于树莓派系统与Blynk远程控制水泵https://blog.csdn.net/gouxf_0219/article/details/80061053</p>
<p>6、当掌控遇上Blynk（2）——远程控制七彩灯https://mc.dfrobot.com.cn/thread-273949-1-1.html</p>
<p>7、搭建blynk本地服务器https://www.zhihu.com/question/290599206/answer/530065590</p>
<p>8、set_property帮助https://community.blynk.cc/t/setproperty-blynklib-py/32854</p>
<p>9、winform连入blynk服务https://blog.csdn.net/u013622530/article/details/96508451</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="8.8-Snowboy.html" class="btn btn-neutral float-right" title="8. 唤醒词检测引擎Snowboy" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="8.6-lnmp.html" class="btn btn-neutral float-left" title="6. 搭建LNMP和WordPress" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, vvboard

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>